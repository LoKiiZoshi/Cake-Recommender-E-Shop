{% extends "shop/base.html" %} {% load static %} {% block title %} Order #
{{order.order_ref }} {% endblock %} {% block content %}
<div class="container py-5">
  <div class="row">
    <div class="col-md-8">
      <div class="card shadow mb-4">
        <div
          class="card-header bg-primary text-white d-flex justify-content-between align-items-center"
        >
          <h4 class="mb-0">Order #{{ order.order_ref }}</h4>
          <span
            class="badge {% if order.status == 'pending' %}bg-warning text-dark{% elif order.status == 'processing' %}bg-info text-dark{% elif order.status == 'shipped' %}bg-primary{% elif order.status == 'delivered' %}bg-success{% elif order.status == 'cancelled' %}bg-danger{% endif %}"
          >
            {{ order.get_status_display }}
          </span>
        </div>
        <div class="card-body">
          <div class="row mb-4">
            <div class="col-md-6">
              <h5>Order Information</h5>
              <p><strong>Date:</strong>{{ order.created|date:"F d, Y" }}</p>
              <p>
                <strong>Payment Method:</strong>
                {{order.get_payment_method_display }}
              </p>
              <p>
                <strong>Payment Status:</strong>
                <span
                  class="badge {% if order.payment_status == 'pending' %}bg-warning text-dark{% elif order.payment_status == 'completed' %}bg-success{% elif order.payment_status == 'failed' %}bg-danger{% endif %}"
                >
                  {{ order.get_payment_status_display }}
                </span>
              </p>
              {% if order.payment_date %}
              <p>
                <strong>Payment Date:</strong>
                {{ order.payment_date|date:"F d,Y" }}
              </p>
              {% endif %}
            </div>
            <div class="col-md-6">
              <h5>Shipping Information</h5>
              <p><strong>Name:</strong> {{ order.first_name }}</p>
              <p><strong>Address:</strong> {{ order.address }}</p>
              <p><strong>City:</strong> {{ order.city }}</p>
              <p><strong>Postal Code:</strong> {{ order.postal_code }}</p>
            </div>
          </div>

          <h5>Order Items</h5>
          <div class="table-responsive">
            <table class="table">
              <thead>
                <tr>
                  <th>Product</th>
                  <th>Price</th>
                  <th>Quantity</th>
                  <th class="text-end">Total</th>
                </tr>
              </thead>
              <tbody>
                {% for item in order.items.all %}
                <tr>
                  <td>{{ item.product.name }}</td>
                  <td>Rs. {{ item.price }}</td>
                  <td>{{ item.quantity }}</td>
                  <td class="text-end">Rs. {{ item.get_cost }}</td>
                </tr>
                {% endfor %}
                <tr>
                  <td colspan="3" class="text-end"><strong>Total</strong></td>
                  <td class="text-end">
                    <strong>Rs. {{ order.get_total_cost }}</strong>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>

          <div class="mt-4 text-center">
            <a
              href="{% url 'shop:esewa_payment' order.id %}"
              class="btn btn-success"
            >
              <i class="fas fa-credit-card me-2"></i> Pay with eSewa
            </a>
          </div>
        </div>
      </div>
    </div>

    <div class="col-md-4">
      <div class="card shadow">
        <div class="card-header bg-light">
          <h5 class="mb-0">Order Summary</h5>
        </div>
        <div class="card-body">
          <div class="d-flex justify-content-between mb-2">
            <span>Subtotal:</span>
            <span>Rs. {{ order.get_total_cost }}</span>
          </div>
          <div class="d-flex justify-content-between mb-2">
            <span>Shipping:</span>
            <span>Free</span>
          </div>
          <div class="d-flex justify-content-between mb-2">
            <span>Tax:</span>
            <span>Included</span>
          </div>
          <hr />
          <div class="d-flex justify-content-between">
            <strong>Total:</strong>
            <strong>Rs. {{ order.get_total_cost }}</strong>
          </div>
        </div>
        <div class="card-footer">
          <a
            href="{% url 'shop:order_history' %}"
            class="btn btn-outline-primary w-100"
          >
            <i class="fas fa-arrow-left me-2"></i> Back to Orders
          </a>
        </div>
      </div>

      {% if order.status == 'shipped' %}
      <div class="card shadow mt-4">
        <div class="card-header bg-light">
          <h5 class="mb-0">Tracking Information</h5>
        </div>
        <div class="card-body">
          <p>Your order is on the way!</p>
          <p><strong>Estimated Delivery:</strong> 2-3 business days</p>
        </div>
      </div>
      {% endif %}
    </div>
  </div>
</div>
{% endblock %}
