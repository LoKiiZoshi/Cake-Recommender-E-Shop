{% extends 'shop/base.html' %} {% block title %}Checkout - Smart Cake
Shop{%endblock %} {% block content %}
<div class="container my-5">
  <h1 class="mb-4">Checkout</h1>

  <div class="row">
    <!-- Order Summary -->
    <div class="col-md-4 order-md-2 mb-4">
      <div class="card">
        <div class="card-header bg-primary text-white">
          <h4 class="mb-0">Order Summary</h4>
        </div>
        <div class="card-body">
          <ul class="list-group list-group-flush">
            {% for item in cart %}
            <li class="list-group-item d-flex justify-content-between lh-sm">
              <div class="d-flex align-items-center">
                {% if item.product.image %}
                <img
                  src="{{ item.product.image.url }}"
                  alt="{{ item.product.name }}"
                  style="
                    width: 60px;
                    height: 60px;
                    object-fit: cover;
                    margin-right: 10px;
                  "
                />
                {% else %}
                <img
                  src="/static/images/placeholder.jpg"
                  alt="No image"
                  style="
                    width: 60px;
                    height: 60px;
                    object-fit: cover;
                    margin-right: 10px;
                  "
                />
                {% endif %}
                <div>
                  <h6 class="my-0">{{ item.product.name }}</h6>
                  <small class="text-muted"
                    >Quantity: {{ item.quantity }}</small
                  >
                </div>
              </div>
              <span class="text-muted">Rs: {{ item.total_price }}</span>
            </li>
            {% endfor %}
            <li class="list-group-item d-flex justify-content-between">
              <span>Total</span>
              <strong>Rs: {{ cart.get_total_price }}</strong>
            </li>
          </ul>
        </div>
      </div>
    </div>

    <!-- Checkout Form -->
    <div class="col-md-8 order-md-1">
      <div class="checkout-form">
        <h4 class="mb-3">Shipping Information</h4>
        <form method="post" id="orderForm" action="{% url 'shop:checkout' %}">
          {% csrf_token %}

          <div class="row g-3">
            <div class="col-md-6">
              <label for="{{ form.first_name.id_for_label }}" class="form-label"
                >First name</label
              >
              {{ form.first_name.errors }}
              <input
                type="text"
                class="form-control"
                id="{{ form.first_name.id_for_label }}"
                name="{{ form.first_name.html_name }}"
                value="{{ form.first_name.value|default:'' }}"
                required
              />
            </div>

            <div class="col-md-6">
              <label for="{{ form.last_name.id_for_label }}" class="form-label"
                >Last name</label
              >
              {{ form.last_name.errors }}
              <input
                type="text"
                class="form-control"
                id="{{ form.last_name.id_for_label }}"
                name="{{ form.last_name.html_name }}"
                value="{{ form.last_name.value|default:'' }}"
                required
              />
            </div>

            <div class="col-12">
              <label for="{{ form.email.id_for_label }}" class="form-label"
                >Email</label
              >
              {{ form.email.errors }}
              <input
                type="email"
                class="form-control"
                id="{{ form.email.id_for_label }}"
                name="{{ form.email.html_name }}"
                value="{{ form.email.value|default:'' }}"
                required
              />
            </div>

            <div class="col-12">
              <label for="{{ form.address.id_for_label }}" class="form-label"
                >Address</label
              >
              {{ form.address.errors }}
              <input
                type="text"
                class="form-control"
                id="{{ form.address.id_for_label }}"
                name="{{ form.address.html_name }}"
                value="{{ form.address.value|default:'' }}"
                required
              />
            </div>

            <div class="col-md-5">
              <label for="{{ form.city.id_for_label }}" class="form-label"
                >City</label
              >
              {{ form.city.errors }}
              <input
                type="text"
                class="form-control"
                id="{{ form.city.id_for_label }}"
                name="{{ form.city.html_name }}"
                value="{{ form.city.value|default:'' }}"
                required
              />
            </div>

            <div class="col-md-4">
              <label
                for="{{ form.postal_code.id_for_label }}"
                class="form-label"
                >Postal Code</label
              >
              {{ form.postal_code.errors }}
              <input
                type="text"
                class="form-control"
                id="{{ form.postal_code.id_for_label }}"
                name="{{ form.postal_code.html_name }}"
                value="{{ form.postal_code.value|default:'' }}"
                required
              />
            </div>
          </div>

          <hr class="my-4" />

          <h4 class="mb-3">Payment Method</h4>
          <div class="my-3">
            <div class="form-check mb-3">
              <input
                id="cod"
                name="payment_method"
                type="radio"
                class="form-check-input"
                value="cod"
                checked
                required
              />
              <label class="form-check-label" for="cod">Cash on Delivery</label>
            </div>
            <div class="form-check mb-3">
              <input
                id="esewa"
                name="payment_method"
                type="radio"
                class="form-check-input"
                value="esewa"
                required
              />
              <label class="form-check-label" for="esewa"> eSewa </label>
              <div class="form-text">
                Pay securely with eSewa. You'll be redirected to eSewa to
                complete your payment.
              </div>
            </div>
          </div>

          <hr class="my-4" />

          <button class="w-100 btn btn-primary btn-lg" type="submit">
            Place Order
          </button>

          <input
            type="hidden"
            name="payment_status"
            id="payment_status"
            value="pending"
          />
        </form>
      </div>
    </div>
  </div>
</div>

{% block extra_js %}
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const codRadio = document.getElementById("cod");
    const esewaRadio = document.getElementById("esewa");
    const paymentStatus = document.getElementById("payment_status");

    function updatePaymentStatus() {
      if (esewaRadio.checked) {
        paymentStatus.value = "pending_payment";
      } else {
        paymentStatus.value = "pending";
      }
    }

    codRadio.addEventListener("change", updatePaymentStatus);
    esewaRadio.addEventListener("change", updatePaymentStatus);

    // Initial check
    updatePaymentStatus();
  });
</script>
{% endblock %} {% endblock %}
