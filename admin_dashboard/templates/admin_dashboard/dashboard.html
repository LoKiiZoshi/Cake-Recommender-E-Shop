{% extends 'shop/base.html' %} {% block title %}Admin Dashboard - Smart Cake
Shop{% endblock %} {% block content %}
<div class="container my-5">
  <h1 class="mb-4">Admin Dashboard</h1>

  <!-- Dashboard Stats -->
  <div class="row dashboard-stats">
    <div class="col-md-3 mb-4">
      <div class="stat-card">
        <h3>{{ total_orders }}</h3>
        <p>Total Orders</p>
      </div>
    </div>
    <div class="col-md-3 mb-4">
      <div class="stat-card">
        <h3>{{ pending_orders }}</h3>
        <p>Pending Orders</p>
      </div>
    </div>
    <div class="col-md-3 mb-4">
      <div class="stat-card">
        <h3>{{ total_products }}</h3>
        <p>Total Products</p>
      </div>
    </div>
    <div class="col-md-3 mb-4">
      <div class="stat-card">
        <h3>{{ total_customers }}</h3>
        <p>Total Customers</p>
      </div>
    </div>
  </div>

  <!-- eSewa Payment Alert -->
  {% if pending_esewa_payments > 0 %}
  <div class="alert alert-warning mb-4">
    <div class="d-flex justify-content-between align-items-center">
      <div>
        <h5 class="mb-1">
          <i class="fas fa-exclamation-triangle"></i> Pending eSewa Payments
        </h5>
        <p class="mb-0">
          You have {{ pending_esewa_payments }} eSewa payment(s) waiting for
          approval.
        </p>
      </div>
      <a
        href="{% url 'admin_dashboard:esewa_payments' %}"
        class="btn btn-primary"
      >
        <i class="fas fa-check-circle"></i> Process Payments
      </a>
    </div>
  </div>
  {% endif %}

  <div class="row">
    <!-- Recent Orders -->
    <div class="col-md-8">
      <div class="card mb-4">
        <div class="card-header bg-primary text-white">
          <h4 class="mb-0">Recent Orders</h4>
        </div>
        <div class="card-body">
          {% if recent_orders %}
          <div class="table-responsive">
            <table class="table admin-table">
              <thead>
                <tr>
                  <th>Order #</th>
                  <th>Customer</th>
                  <th>Date</th>
                  <th>Status</th>
                  <th>Payment</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                {% for order in recent_orders %}
                <tr>
                  <td>{{ order.order_ref }}</td>
                  <td>{{ order.user.username }}</td>
                  <td>{{ order.created|date:"M d, Y" }}</td>
                  <td>
                    <span
                      class="badge {% if order.status == 'delivered' %}bg-success{% elif order.status == 'cancelled' %}bg-danger{% else %}bg-warning{% endif %}"
                    >
                      {{ order.get_status_display }}
                    </span>
                  </td>
                  <td>
                    <span
                      class="badge {% if order.payment_status == 'completed' %}bg-success{% elif order.payment_status == 'failed' %}bg-danger{% elif order.payment_status == 'pending_payment' %}bg-warning{% else %}bg-success{% endif %}"
                    >
                      {{ order.get_payment_method_display }} -
                      {{order.get_payment_status_display }}
                    </span>
                  </td>
                  <td>
                    <a
                      href="{% url 'admin_dashboard:order_detail' order.id %}"
                      class="btn btn-sm btn-primary"
                    >
                      <i class="fas fa-eye"></i>
                    </a>
                  </td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
          <div class="text-end mt-3">
            <a
              href="{% url 'admin_dashboard:orders' %}"
              class="btn btn-outline-primary"
              >View All Orders</a
            >
          </div>
          {% else %}
          <p class="text-center">No orders yet.</p>
          {% endif %}
        </div>
      </div>
    </div>

    <!-- Top Selling Products -->
    <div class="col-md-4">
      <div class="card">
        <div class="card-header bg-primary text-white">
          <h4 class="mb-0">Top Selling Products</h4>
        </div>
        <div class="card-body">
          {% if top_products %}
          <ul class="list-group list-group-flush">
            {% for product in top_products %}
            <li
              class="list-group-item d-flex justify-content-between align-items-center"
            >
              {{ product.product__name }}
              <span class="badge bg-primary rounded-pill"
                >{{ product.total_quantity }} sold</span
              >
            </li>
            {% endfor %}
          </ul>
          {% else %}
          <p class="text-center">No sales data yet.</p>
          {% endif %}
        </div>
      </div>
    </div>
  </div>

  <!-- Quick Links -->
  <div class="row mt-4">
    <div class="col-12">
      <div class="card">
        <div class="card-header bg-primary text-white">
          <h4 class="mb-0">Quick Actions</h4>
        </div>
        <div class="card-body">
          <div class="row">
            <div class="col-md-3 mb-3">
              <a
                href="{% url 'admin_dashboard:product_create' %}"
                class="btn btn-outline-primary w-100 py-3"
              >
                <i class="fas fa-plus-circle fa-2x mb-2"></i><br />
                Add New Product
              </a>
            </div>
            <div class="col-md-3 mb-3">
              <a
                href="{% url 'admin_dashboard:category_create' %}"
                class="btn btn-outline-primary w-100 py-3"
              >
                <i class="fas fa-folder-plus fa-2x mb-2"></i><br />
                Add New Category
              </a>
            </div>
            <div class="col-md-3 mb-3">
              <a
                href="{% url 'admin_dashboard:esewa_payments' %}"
                class="btn btn-outline-primary w-100 py-3"
              >
                <i class="fas fa-credit-card fa-2x mb-2"></i><br />
                Manage Payments
              </a>
            </div>
            <div class="col-md-3 mb-3">
              <a
                href="{% url 'admin_dashboard:customers' %}"
                class="btn btn-outline-primary w-100 py-3"
              >
                <i class="fas fa-users fa-2x mb-2"></i><br />
                View Customers
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}
