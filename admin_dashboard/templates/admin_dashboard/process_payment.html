{% extends 'shop/base.html' %} {% block title %}Process eSewa Payment - Admin
Dashboard{% endblock %} {% block content %}
<div class="container my-5">
  <div class="row justify-content-center">
    <div class="col-md-8">
      <div class="card">
        <div class="card-header bg-primary text-white">
          <h4 class="mb-0">Process eSewa Payment</h4>
        </div>
        <div class="card-body">
          <h5 class="mb-3">Order #{{ order.order_ref }}</h5>

          <div class="row mb-4">
            <div class="col-md-6">
              <p><strong>Customer:</strong> {{ order.user.username }}</p>
              <p><strong>Date:</strong> {{ order.created|date:"F d, Y" }}</p>
              <p><strong>Amount:</strong> Rs. {{ order.get_total_cost }}</p>
            </div>
            <div class="col-md-6">
              <p>
                <strong>Payment Status:</strong>
                <span
                  class="badge {% if order.payment_status == 'completed' %}bg-success{% elif order.payment_status == 'failed' %}bg-danger{% elif order.payment_status == 'pending_payment' %}bg-warning{% else %}bg-secondary{% endif %}"
                >
                  {{ order.get_payment_status_display }}
                </span>
              </p>
              <p>
                <strong>Order Status:</strong>
                <span
                  class="badge {% if order.status == 'delivered' %}bg-success{% elif order.status == 'cancelled' %}bg-danger{% elif order.status == 'processing' %}bg-info{% else %}bg-warning{% endif %}"
                >
                  {{ order.get_status_display }}
                </span>
              </p>
              <p>
                <strong>Transaction ID: </strong>
                {{order.transaction_id|default:"N/A" }}
              </p>
            </div>
          </div>

          <div class="alert alert-info">
            <h5><i class="fas fa-info-circle"></i> Payment Verification</h5>
            <p>
              This order has been paid through eSewa and is waiting for your
              approval to be processed.
            </p>
          </div>

          <div class="d-flex justify-content-between mt-4">
            <form
              method="post"
              action="{% url 'admin_dashboard:process_esewa_payment' order.id %}"
            >
              {% csrf_token %}
              <input type="hidden" name="action" value="reject" />
              <button
                type="submit"
                class="btn btn-danger"
                onclick="return confirm('Are you sure you want to reject this payment?')"
              >
                <i class="fas fa-times-circle"></i> Reject Payment
              </button>
            </form>

            <form
              method="post"
              action="{% url 'admin_dashboard:process_esewa_payment' order.id %}"
            >
              {% csrf_token %}
              <input type="hidden" name="action" value="approve" />
              <button type="submit" class="btn btn-success">
                <i class="fas fa-check-circle"></i> Approve Payment
              </button>
            </form>
          </div>

          <div class="alert alert-warning">
            <h5><i class="fas fa-exclamation-triangle"></i> Cannot Process</h5>
            <p>
              This order cannot be processed because either the payment is not
              completed or the order is not in pending status.
            </p>
          </div>

          <div class="text-center mt-4">
            <a
              href="{% url 'admin_dashboard:esewa_payments' %}"
              class="btn btn-primary"
            >
              <i class="fas fa-arrow-left"></i> Back to Payments
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}
